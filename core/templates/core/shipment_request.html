{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card border-0 shadow-sm p-4" style="border-radius: 20px;">
                <h2 class="mb-4">{% trans "Request a Shipment" %}</h2>
                <form method="POST">
                    {% csrf_token %}
                    <div class="row g-3">
                        {% for field in form %}
                        <div class="{% if field.name == 'description' %}col-12{% else %}col-md-6{% endif %}">
                            <label class="form-label" for="{{ field.id_for_label }}">{{ field.label }}</label>
                            {{ field }}
                            {% if field.errors %}
                            <div class="text-danger small">{{ field.errors }}</div>
                            {% endif %}
                        </div>
                        {% endfor %}
                        <div class="col-12 mt-4">
                            <button type="submit" class="btn btn-masarx-primary w-100 py-3">{% trans "Submit Request" %}</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    function setupDependentDropdowns(countryId, governateId, cityId) {
        const countrySelect = document.getElementById(countryId);
        const governateSelect = document.getElementById(governateId);
        const citySelect = document.getElementById(cityId);

        if (!countrySelect || !governateSelect || !citySelect) return;

        countrySelect.addEventListener('change', function() {
            const val = this.value;
            governateSelect.innerHTML = '<option value="">{% trans "Select Governate" %}</option>';
            citySelect.innerHTML = '<option value="">{% trans "Select City" %}</option>';
            
            if (val) {
                fetch(`/ajax/get-governates/?country_id=${val}`)
                    .then(response => response.json())
                    .then(data => {
                        data.forEach(item => {
                            const option = document.createElement('option');
                            option.value = item.id;
                            option.textContent = item.name;
                            governateSelect.appendChild(option);
                        });
                    });
            }
        });

        governateSelect.addEventListener('change', function() {
            const val = this.value;
            citySelect.innerHTML = '<option value="">{% trans "Select City" %}</option>';
            
            if (val) {
                fetch(`/ajax/get-cities/?governate_id=${val}`)
                    .then(response => response.json())
                    .then(data => {
                        data.forEach(item => {
                            const option = document.createElement('option');
                            option.value = item.id;
                            option.textContent = item.name;
                            citySelect.appendChild(option);
                        });
                    });
            }
        });
    }

    setupDependentDropdowns('id_pickup_country', 'id_pickup_governate', 'id_pickup_city');
    setupDependentDropdowns('id_delivery_country', 'id_delivery_governate', 'id_delivery_city');
});
</script>
{% endblock %}
